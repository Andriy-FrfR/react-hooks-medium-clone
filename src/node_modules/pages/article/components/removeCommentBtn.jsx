import useFetch from 'hooks/useFetch';
import { useEffect, useState } from 'react';

const RemoveCommentBtn = ({
  commentId,
  articleSlug,
  comments,
  setComments,
}) => {
  const apiUrl = `/articles/${articleSlug}/comments/${commentId}`;
  const [{ response, isLoading }, doFetch] = useFetch(apiUrl);

  const removeCommentHandler = () => {
    doFetch({
      method: 'delete',
    });
  };

  useEffect(() => {
    if (response === null || isLoading) {
      return;
    }

    const newComments = comments.filter((comment) => {
      if (comment.id === commentId) {
        return false;
      }

      return true;
    });

    setComments(newComments);
  }, [isLoading]);

  return <i className="ion-trash-a" onClick={removeCommentHandler} />;
};

export default RemoveCommentBtn;
